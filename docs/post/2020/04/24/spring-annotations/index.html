<!doctype html><html lang=zh-cn itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Spring Annotations - itning</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=MobileOptimized content="width"><meta name=HandheldFriendly content="true"><meta name=applicable-device content="pc,mobile"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=mobile-web-app-capable content="yes"><meta name=author content="Guide哥"><meta name=description content="0.前言 转载自：https://github.com/Snailclimb/JavaGuide。
可以毫不夸张地说，这篇文章介绍的 Spring/SpringBoot 常用注解基本已经涵盖你工作中遇到的大部分常用的场景。对于每一个注解我都说了具体用法，掌握搞懂，使用 SpringBoot 来开发项目基本没啥大问题了！"><meta name=keywords content="itning,我们始终是路人,blog,java"><meta name=generator content="Hugo 0.68.1"><link rel=canonical href=https://blog.itning.top/post/2020/04/24/spring-annotations/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/sass/jane.min.af20b78e95c84de86b00a0242a4a77bd2601700e1b250edf27537d957ac0041d.css integrity="sha256-ryC3jpXITehrAKAkKkp3vSYBcA4bJQ7fJ1N9lXrABB0=" media=screen crossorigin=anonymous><meta property="og:title" content="Spring Annotations"><meta property="og:description" content="0.前言
转载自：https://github.com/Snailclimb/JavaGuide。
可以毫不夸张地说，这篇文章介绍的 Spring/SpringBoot 常用注解基本已经涵盖你工作中遇到的大部分常用的场景。对于每一个注解我都说了具体用法，掌握搞懂，使用 SpringBoot 来开发项目基本没啥大问题了！"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.itning.top/post/2020/04/24/spring-annotations/"><meta property="article:published_time" content="2020-04-24T11:30:12+08:00"><meta property="article:modified_time" content="2020-04-24T11:30:12+08:00"><meta itemprop=name content="Spring Annotations"><meta itemprop=description content="0.前言
转载自：https://github.com/Snailclimb/JavaGuide。
可以毫不夸张地说，这篇文章介绍的 Spring/SpringBoot 常用注解基本已经涵盖你工作中遇到的大部分常用的场景。对于每一个注解我都说了具体用法，掌握搞懂，使用 SpringBoot 来开发项目基本没啥大问题了！"><meta itemprop=datePublished content="2020-04-24T11:30:12+08:00"><meta itemprop=dateModified content="2020-04-24T11:30:12+08:00"><meta itemprop=wordCount content="2068"><meta itemprop=keywords content="spring,annotations,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Spring Annotations"><meta name=twitter:description content="0.前言
转载自：https://github.com/Snailclimb/JavaGuide。
可以毫不夸张地说，这篇文章介绍的 Spring/SpringBoot 常用注解基本已经涵盖你工作中遇到的大部分常用的场景。对于每一个注解我都说了具体用法，掌握搞懂，使用 SpringBoot 来开发项目基本没啥大问题了！"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>itning</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><li class=mobile-menu-item><a class=menu-item-link href=https://blog.itning.top/>主页</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://blog.itning.top/post/>归档</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://blog.itning.top/tags/>标签</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://blog.itning.top/categories/>分类</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://github.com/itning rel=noopener target=_blank>GitHub
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408 512.128C896 481.792 871.424 457.152 841.152 457.152z"/></svg></i></a></li></ul></nav><link href=https://cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.css rel=stylesheet><link href=https://cdn.bootcss.com/photoswipe/4.1.3/default-skin/default-skin.min.css rel=stylesheet><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header id=header class="header container"><div class=logo-wrapper><a href=/ class=logo>itning</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=https://blog.itning.top/>主页</a></li><li class=menu-item><a class=menu-item-link href=https://blog.itning.top/post/>归档</a></li><li class=menu-item><a class=menu-item-link href=https://blog.itning.top/tags/>标签</a></li><li class=menu-item><a class=menu-item-link href=https://blog.itning.top/categories/>分类</a></li><li class=menu-item><a class=menu-item-link href=https://github.com/itning rel=noopener target=_blank>GitHub
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408 512.128C896 481.792 871.424 457.152 841.152 457.152z"/></svg></i></a></li></ul></nav></header><div id=mobile-panel><main id=main class="main bg-llight"><div class=content-wrapper><div id=content class="content container"><article class="post bg-white"><header class=post-header><h1 class=post-title>Spring Annotations</h1><div class=post-meta><time datetime=2020-04-24 class=post-time>2020年04月24日 11:30:12</time><div class=post-category><a href=https://blog.itning.top/categories/spring/>spring</a></div><span class=more-meta>约 2068 字</span>
<span class=more-meta>预计阅读 10 分钟</span>
<span id=busuanzi_container_page_pv>| 阅读 <span id=busuanzi_value_page_pv></span></span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#0前言>0.前言</a></li><li><a href=#1-springbootapplication>1. <code>@SpringBootApplication</code></a></li><li><a href=#2-spring-bean-相关>2. Spring Bean 相关</a></li><li><a href=#3-处理常见的-http-请求类型>3. 处理常见的 HTTP 请求类型</a></li><li><a href=#4-前后端传值>4. 前后端传值</a></li><li><a href=#5-读取配置信息>5. 读取配置信息</a></li><li><a href=#6-参数校验>6. 参数校验</a></li><li><a href=#7-全局处理-controller-层异常>7. 全局处理 Controller 层异常</a></li><li><a href=#8-jpa-相关>8. JPA 相关</a></li><li><a href=#9-事务-transactional>9. 事务 <code>@Transactional</code></a></li><li><a href=#10-json-数据处理>10. json 数据处理</a></li><li><a href=#11-测试相关>11. 测试相关</a></li></ul></li></ul></nav></div></div><div class=post-content><h3 id=0前言>0.前言</h3><p>转载自：<a href=https://github.com/Snailclimb/JavaGuide>https://github.com/Snailclimb/JavaGuide</a>。</p><p>可以毫不夸张地说，这篇文章介绍的 Spring/SpringBoot 常用注解基本已经涵盖你工作中遇到的大部分常用的场景。对于每一个注解我都说了具体用法，掌握搞懂，使用 SpringBoot 来开发项目基本没啥大问题了！</p><h3 id=1-springbootapplication>1. <code>@SpringBootApplication</code></h3><p>这里先单独拎出<code>@SpringBootApplication</code> 注解说一下，虽然我们一般不会主动去使用它。</p><p><em>Guide 哥：这个注解是 Spring Boot 项目的基石，创建 SpringBoot 项目之后会默认在主类加上。</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@SpringBootApplication</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>SpringSecurityJwtGuideApplication</span> <span class=o>{</span>
      <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>SpringApplication</span><span class=o>.</span><span class=na>run</span><span class=o>(</span><span class=n>SpringSecurityJwtGuideApplication</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>args</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>我们可以把 <code>@SpringBootApplication</code>看作是 <code>@Configuration</code>、<code>@EnableAutoConfiguration</code>、<code>@ComponentScan</code> 注解的集合。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kn>package</span> <span class=nn>org.springframework.boot.autoconfigure</span><span class=o>;</span>
<span class=nd>@Target</span><span class=o>(</span><span class=n>ElementType</span><span class=o>.</span><span class=na>TYPE</span><span class=o>)</span>
<span class=nd>@Retention</span><span class=o>(</span><span class=n>RetentionPolicy</span><span class=o>.</span><span class=na>RUNTIME</span><span class=o>)</span>
<span class=nd>@Documented</span>
<span class=nd>@Inherited</span>
<span class=nd>@SpringBootConfiguration</span>
<span class=nd>@EnableAutoConfiguration</span>
<span class=nd>@ComponentScan</span><span class=o>(</span><span class=n>excludeFilters</span> <span class=o>=</span> <span class=o>{</span>
		<span class=nd>@Filter</span><span class=o>(</span><span class=n>type</span> <span class=o>=</span> <span class=n>FilterType</span><span class=o>.</span><span class=na>CUSTOM</span><span class=o>,</span> <span class=n>classes</span> <span class=o>=</span> <span class=n>TypeExcludeFilter</span><span class=o>.</span><span class=na>class</span><span class=o>),</span>
		<span class=nd>@Filter</span><span class=o>(</span><span class=n>type</span> <span class=o>=</span> <span class=n>FilterType</span><span class=o>.</span><span class=na>CUSTOM</span><span class=o>,</span> <span class=n>classes</span> <span class=o>=</span> <span class=n>AutoConfigurationExcludeFilter</span><span class=o>.</span><span class=na>class</span><span class=o>)</span> <span class=o>})</span>
<span class=kd>public</span> <span class=nd>@interface</span> <span class=n>SpringBootApplication</span> <span class=o>{</span>
   <span class=o>......</span>
<span class=o>}</span>

<span class=kn>package</span> <span class=nn>org.springframework.boot</span><span class=o>;</span>
<span class=nd>@Target</span><span class=o>(</span><span class=n>ElementType</span><span class=o>.</span><span class=na>TYPE</span><span class=o>)</span>
<span class=nd>@Retention</span><span class=o>(</span><span class=n>RetentionPolicy</span><span class=o>.</span><span class=na>RUNTIME</span><span class=o>)</span>
<span class=nd>@Documented</span>
<span class=nd>@Configuration</span>
<span class=kd>public</span> <span class=nd>@interface</span> <span class=n>SpringBootConfiguration</span> <span class=o>{</span>

<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>根据 SpringBoot 官网，这三个注解的作用分别是：</p><ul><li><code>@EnableAutoConfiguration</code>：启用 SpringBoot 的自动配置机制</li><li><code>@ComponentScan</code>： 扫描被<code>@Component</code> (<code>@Service</code>,<code>@Controller</code>)注解的 bean，注解默认会扫描该类所在的包下所有的类。</li><li><code>@Configuration</code>：允许在 Spring 上下文中注册额外的 bean 或导入其他配置类</li></ul><h3 id=2-spring-bean-相关>2. Spring Bean 相关</h3><h4 id=21-autowired>2.1. <code>@Autowired</code></h4><p>自动导入对象到类中，被注入进的类同样要被 Spring 容器管理比如：Service 类注入到 Controller 类中。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Service</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>UserService</span> <span class=o>{</span>
  <span class=o>......</span>
<span class=o>}</span>

<span class=nd>@RestController</span>
<span class=nd>@RequestMapping</span><span class=o>(</span><span class=s>&#34;/users&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>UserController</span> <span class=o>{</span>
   <span class=nd>@Autowired</span>
   <span class=kd>private</span> <span class=n>UserService</span> <span class=n>userService</span><span class=o>;</span>
   <span class=o>......</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><h4 id=22-componentrepositoryservice-controller>2.2. <code>Component</code>,<code>@Repository</code>,<code>@Service</code>, <code>@Controller</code></h4><p>我们一般使用 <code>@Autowired</code> 注解让 Spring 容器帮我们自动装配 bean。要想把类标识成可用于 <code>@Autowired</code> 注解自动装配的 bean 的类,可以采用以下注解实现：</p><ul><li><code>@Component</code> ：通用的注解，可标注任意类为 <code>Spring</code> 组件。如果一个 Bean 不知道属于哪个层，可以使用<code>@Component</code> 注解标注。</li><li><code>@Repository</code> : 对应持久层即 Dao 层，主要用于数据库相关操作。</li><li><code>@Service</code> : 对应服务层，主要涉及一些复杂的逻辑，需要用到 Dao 层。</li><li><code>@Controller</code> : 对应 Spring MVC 控制层，主要用户接受用户请求并调用 Service 层返回数据给前端页面。</li></ul><h4 id=23-restcontroller>2.3. <code>@RestController</code></h4><p><code>@RestController</code>注解是<code>@Controller和</code>@<code>ResponseBody</code>的合集,表示这是个控制器 bean,并且是将函数的返回值直 接填入 HTTP 响应体中,是 REST 风格的控制器。</p><p><em>Guide 哥：现在都是前后端分离，说实话我已经很久没有用过<code>@Controller</code>。如果你的项目太老了的话，就当我没说。</em></p><p>单独使用 <code>@Controller</code> 不加 <code>@ResponseBody</code>的话一般使用在要返回一个视图的情况，这种情况属于比较传统的 Spring MVC 的应用，对应于前后端不分离的情况。<code>@Controller</code> +<code>@ResponseBody</code> 返回 JSON 或 XML 形式数据</p><p>关于<code>@RestController</code> 和 <code>@Controller</code>的对比，请看这篇文章：<a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247485544&idx=1&sn=3cc95b88979e28fe3bfe539eb421c6d8&chksm=cea247a3f9d5ceb5e324ff4b8697adc3e828ecf71a3468445e70221cce768d1e722085359907&token=1725092312&lang=zh_CN#rd">@RestController vs @Controller</a>。</p><h4 id=24-scope>2.4. <code>@Scope</code></h4><p>声明 Spring Bean 的作用域，使用方法:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Bean</span>
<span class=nd>@Scope</span><span class=o>(</span><span class=s>&#34;singleton&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=n>Person</span> <span class=nf>personSingleton</span><span class=o>()</span> <span class=o>{</span>
    <span class=k>return</span> <span class=k>new</span> <span class=n>Person</span><span class=o>();</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p><strong>四种常见的 Spring Bean 的作用域：</strong></p><ul><li>singleton : 唯一 bean 实例，Spring 中的 bean 默认都是单例的。</li><li>prototype : 每次请求都会创建一个新的 bean 实例。</li><li>request : 每一次 HTTP 请求都会产生一个新的 bean，该 bean 仅在当前 HTTP request 内有效。</li><li>session : 每一次 HTTP 请求都会产生一个新的 bean，该 bean 仅在当前 HTTP session 内有效。</li></ul><h4 id=25-configuration>2.5. <code>Configuration</code></h4><p>一般用来声明配置类，可以使用 <code>@Component</code>注解替代，不过使用<code>Configuration</code>注解声明配置类更加语义化。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Configuration</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>AppConfig</span> <span class=o>{</span>
    <span class=nd>@Bean</span>
    <span class=kd>public</span> <span class=n>TransferService</span> <span class=nf>transferService</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>TransferServiceImpl</span><span class=o>();</span>
    <span class=o>}</span>

<span class=o>}</span>
</code></pre></td></tr></table></div></div><h3 id=3-处理常见的-http-请求类型>3. 处理常见的 HTTP 请求类型</h3><p><strong>5 种常见的请求类型:</strong></p><ul><li><strong>GET</strong> ：请求从服务器获取特定资源。举个例子：<code>GET /users</code>（获取所有学生）</li><li><strong>POST</strong> ：在服务器上创建一个新的资源。举个例子：<code>POST /users</code>（创建学生）</li><li><strong>PUT</strong> ：更新服务器上的资源（客户端提供更新后的整个资源）。举个例子：<code>PUT /users/12</code>（更新编号为 12 的学生）</li><li><strong>DELETE</strong> ：从服务器删除特定的资源。举个例子：<code>DELETE /users/12</code>（删除编号为 12 的学生）</li><li><strong>PATCH</strong> ：更新服务器上的资源（客户端提供更改的属性，可以看做作是部分更新），使用的比较少，这里就不举例子了。</li></ul><h4 id=31-get-请求>3.1. GET 请求</h4><p><code>@GetMapping("users")</code> 等价于<code>@RequestMapping(value="/users",method=RequestMethod.GET)</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/users&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;&gt;</span> <span class=nf>getAllUsers</span><span class=o>()</span> <span class=o>{</span>
 <span class=k>return</span> <span class=n>userRepository</span><span class=o>.</span><span class=na>findAll</span><span class=o>();</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><h4 id=32-post-请求>3.2. POST 请求</h4><p><code>@PostMapping("users")</code> 等价于<code>@RequestMapping(value="/users",method=RequestMethod.POST)</code></p><p>关于<code>@RequestBody</code>注解的使用，在下面的“前后端传值”这块会讲到。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@PostMapping</span><span class=o>(</span><span class=s>&#34;/users&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span> <span class=nf>createUser</span><span class=o>(</span><span class=nd>@Valid</span> <span class=nd>@RequestBody</span> <span class=n>UserCreateRequest</span> <span class=n>userCreateRequest</span><span class=o>)</span> <span class=o>{</span>
 <span class=k>return</span> <span class=n>userRespository</span><span class=o>.</span><span class=na>save</span><span class=o>(</span><span class=n>user</span><span class=o>);</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><h4 id=33-put-请求>3.3. PUT 请求</h4><p><code>@PutMapping("/users/{userId}")</code> 等价于<code>@RequestMapping(value="/users/{userId}",method=RequestMethod.PUT)</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@PutMapping</span><span class=o>(</span><span class=s>&#34;/users/{userId}&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span> <span class=nf>updateUser</span><span class=o>(</span><span class=nd>@PathVariable</span><span class=o>(</span><span class=n>value</span> <span class=o>=</span> <span class=s>&#34;userId&#34;</span><span class=o>)</span> <span class=n>Long</span> <span class=n>userId</span><span class=o>,</span>
  <span class=nd>@Valid</span> <span class=nd>@RequestBody</span> <span class=n>UserUpdateRequest</span> <span class=n>userUpdateRequest</span><span class=o>)</span> <span class=o>{</span>
  <span class=o>......</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><h4 id=34-delete-请求>3.4. <strong>DELETE 请求</strong></h4><p><code>@DeleteMapping("/users/{userId}")</code>等价于<code>@RequestMapping(value="/users/{userId}",method=RequestMethod.DELETE)</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@DeleteMapping</span><span class=o>(</span><span class=s>&#34;/users/{userId}&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=n>ResponseEntity</span> <span class=nf>deleteUser</span><span class=o>(</span><span class=nd>@PathVariable</span><span class=o>(</span><span class=n>value</span> <span class=o>=</span> <span class=s>&#34;userId&#34;</span><span class=o>)</span> <span class=n>Long</span> <span class=n>userId</span><span class=o>){</span>
  <span class=o>......</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><h4 id=35-patch-请求>3.5. <strong>PATCH 请求</strong></h4><p>一般实际项目中，我们都是 PUT 不够用了之后才用 PATCH 请求去更新数据。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java>  <span class=nd>@PatchMapping</span><span class=o>(</span><span class=s>&#34;/profile&#34;</span><span class=o>)</span>
  <span class=kd>public</span> <span class=n>ResponseEntity</span> <span class=nf>updateStudent</span><span class=o>(</span><span class=nd>@RequestBody</span> <span class=n>StudentUpdateRequest</span> <span class=n>studentUpdateRequest</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>studentRepository</span><span class=o>.</span><span class=na>updateDetail</span><span class=o>(</span><span class=n>studentUpdateRequest</span><span class=o>);</span>
        <span class=k>return</span> <span class=n>ResponseEntity</span><span class=o>.</span><span class=na>ok</span><span class=o>().</span><span class=na>build</span><span class=o>();</span>
    <span class=o>}</span>
</code></pre></td></tr></table></div></div><h3 id=4-前后端传值>4. 前后端传值</h3><p><strong>掌握前后端传值的正确姿势，是你开始 CRUD 的第一步！</strong></p><h4 id=41-pathvariable-和-requestparam>4.1. <code>@PathVariable</code> 和 <code>@RequestParam</code></h4><p><code>@PathVariable</code>用于获取路径参数，<code>@RequestParam</code>用于获取查询参数。</p><p>举个简单的例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/klasses/{klassId}/teachers&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Teacher</span><span class=o>&gt;</span> <span class=nf>getKlassRelatedTeachers</span><span class=o>(</span>
         <span class=nd>@PathVariable</span><span class=o>(</span><span class=s>&#34;klassId&#34;</span><span class=o>)</span> <span class=n>Long</span> <span class=n>klassId</span><span class=o>,</span>
         <span class=nd>@RequestParam</span><span class=o>(</span><span class=n>value</span> <span class=o>=</span> <span class=s>&#34;type&#34;</span><span class=o>,</span> <span class=n>required</span> <span class=o>=</span> <span class=kc>false</span><span class=o>)</span> <span class=n>String</span> <span class=n>type</span> <span class=o>)</span> <span class=o>{</span>
<span class=o>...</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>如果我们请求的 url 是：<code>/klasses/{123456}/teachers?type=web</code></p><p>那么我们服务获取到的数据就是：<code>klassId=123456,type=web</code>。</p><h4 id=42-requestbody>4.2. <code>@RequestBody</code></h4><p>用于读取 Request 请求（可能是 POST,PUT,DELETE,GET 请求）的 body 部分并且<strong>Content-Type 为 application/json</strong> 格式的数据，接收到数据之后会自动将数据绑定到 Java 对象上去。系统会使用<code>HttpMessageConverter</code>或者自定义的<code>HttpMessageConverter</code>将请求的 body 中的 json 字符串转换为 java 对象。</p><p>我用一个简单的例子来给演示一下基本使用！</p><p>我们有一个注册的接口：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@PostMapping</span><span class=o>(</span><span class=s>&#34;/sign-up&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=n>ResponseEntity</span> <span class=nf>signUp</span><span class=o>(</span><span class=nd>@RequestBody</span> <span class=nd>@Valid</span> <span class=n>UserRegisterRequest</span> <span class=n>userRegisterRequest</span><span class=o>)</span> <span class=o>{</span>
  <span class=n>userService</span><span class=o>.</span><span class=na>save</span><span class=o>(</span><span class=n>userRegisterRequest</span><span class=o>);</span>
  <span class=k>return</span> <span class=n>ResponseEntity</span><span class=o>.</span><span class=na>ok</span><span class=o>().</span><span class=na>build</span><span class=o>();</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p><code>UserRegisterRequest</code>对象：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Data</span>
<span class=nd>@AllArgsConstructor</span>
<span class=nd>@NoArgsConstructor</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>UserRegisterRequest</span> <span class=o>{</span>
    <span class=nd>@NotBlank</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>userName</span><span class=o>;</span>
    <span class=nd>@NotBlank</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>password</span><span class=o>;</span>
    <span class=nd>@FullName</span>
    <span class=nd>@NotBlank</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>fullName</span><span class=o>;</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>我们发送 post 请求到这个接口，并且 body 携带 JSON 数据：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span><span class=nt>&#34;userName&#34;</span><span class=p>:</span><span class=s2>&#34;coder&#34;</span><span class=p>,</span><span class=nt>&#34;fullName&#34;</span><span class=p>:</span><span class=s2>&#34;shuangkou&#34;</span><span class=p>,</span><span class=nt>&#34;password&#34;</span><span class=p>:</span><span class=s2>&#34;123456&#34;</span><span class=p>}</span>
</code></pre></td></tr></table></div></div><p>这样我们的后端就可以直接把 json 格式的数据映射到我们的 <code>UserRegisterRequest</code> 类上。</p><p><img src=/images/20200424113400.png alt></p><p>👉 需要注意的是：<strong>一个请求方法只可以有一个<code>@RequestBody</code>，但是可以有多个<code>@RequestParam</code>和<code>@PathVariable</code></strong>。 如果你的方法必须要用两个 <code>@RequestBody</code>来接受数据的话，大概率是你的数据库设计或者系统设计出问题了！</p><h3 id=5-读取配置信息>5. 读取配置信息</h3><p><strong>很多时候我们需要将一些常用的配置信息比如阿里云 oss、发送短信、微信认证的相关配置信息等等放到配置文件中。</strong></p><p><strong>下面我们来看一下 Spring 为我们提供了哪些方式帮助我们从配置文件中读取这些配置信息。</strong></p><p>我们的数据源<code>application.yml</code>内容如下：：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>wuhan2020</span><span class=p>:</span><span class=w> </span>2020年初武汉爆发了新型冠状病毒，疫情严重，但是，我相信一切都会过去！武汉加油！中国加油！<span class=w>
</span><span class=w>
</span><span class=w></span>my-profile<span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>name</span><span class=p>:</span><span class=w> </span>Guide哥<span class=w>
</span><span class=w>  </span><span class=k>email</span><span class=p>:</span><span class=w> </span>koushuangbwcx@<span class=m>163.</span>com<span class=w>
</span><span class=w>
</span><span class=w></span>library<span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>location</span><span class=p>:</span><span class=w> </span>湖北武汉加油中国加油<span class=w>
</span><span class=w>  </span>books<span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>天才基本法<span class=w>
</span><span class=w>      </span><span class=k>description</span><span class=p>:</span><span class=w> </span>二十二岁的林朝夕在父亲确诊阿尔茨海默病这天，得知自己暗恋多年的校园男神裴之即将出国深造的消息——对方考取的学校，恰是父亲当年为她放弃的那所。<span class=w>
</span><span class=w>    </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>时间的秩序<span class=w>
</span><span class=w>      </span><span class=k>description</span><span class=p>:</span><span class=w> </span>为什么我们记得过去，而非未来？时间“流逝”意味着什么？是我们存在于时间之内，还是时间存在于我们之中？卡洛·罗韦利用诗意的文字，邀请我们思考这一亘古难题——时间的本质。<span class=w>
</span><span class=w>    </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>了不起的我<span class=w>
</span><span class=w>      </span><span class=k>description</span><span class=p>:</span><span class=w> </span>如何养成一个新习惯？如何让心智变得更成熟？如何拥有高质量的关系？<span class=w> </span>如何走出人生的艰难时刻？<span class=w>
</span></code></pre></td></tr></table></div></div><h4 id=51-value常用>5.1. <code>@value</code>(常用)</h4><p>使用 <code>@Value("${property}")</code> 读取比较简单的配置信息：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Value</span><span class=o>(</span><span class=s>&#34;${wuhan2020}&#34;</span><span class=o>)</span>
<span class=n>String</span> <span class=n>wuhan2020</span><span class=o>;</span>
</code></pre></td></tr></table></div></div><h4 id=52-configurationproperties常用>5.2. <code>@ConfigurationProperties</code>(常用)</h4><p>通过<code>@ConfigurationProperties</code>读取配置信息并与 bean 绑定。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Component</span>
<span class=nd>@ConfigurationProperties</span><span class=o>(</span><span class=n>prefix</span> <span class=o>=</span> <span class=s>&#34;library&#34;</span><span class=o>)</span>
<span class=kd>class</span> <span class=nc>LibraryProperties</span> <span class=o>{</span>
    <span class=nd>@NotEmpty</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>location</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Book</span><span class=o>&gt;</span> <span class=n>books</span><span class=o>;</span>

    <span class=nd>@Setter</span>
    <span class=nd>@Getter</span>
    <span class=nd>@ToString</span>
    <span class=kd>static</span> <span class=kd>class</span> <span class=nc>Book</span> <span class=o>{</span>
        <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
        <span class=n>String</span> <span class=n>description</span><span class=o>;</span>
    <span class=o>}</span>
  <span class=n>省略getter</span><span class=o>/</span><span class=n>setter</span>
  <span class=o>......</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>你可以像使用普通的 Spring bean 一样，将其注入到类中使用。</p><h4 id=53-propertysource不常用>5.3. <code>PropertySource</code>（不常用）</h4><p><code>@PropertySource</code>读取指定 properties 文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Component</span>
<span class=nd>@PropertySource</span><span class=o>(</span><span class=s>&#34;classpath:website.properties&#34;</span><span class=o>)</span>

<span class=kd>class</span> <span class=nc>WebSite</span> <span class=o>{</span>
    <span class=nd>@Value</span><span class=o>(</span><span class=s>&#34;${url}&#34;</span><span class=o>)</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>url</span><span class=o>;</span>

  <span class=n>省略getter</span><span class=o>/</span><span class=n>setter</span>
  <span class=o>......</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>更多内容请查看我的这篇文章：《<a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247486181&idx=2&sn=10db0ae64ef501f96a5b0dbc4bd78786&chksm=cea2452ef9d5cc384678e456427328600971180a77e40c13936b19369672ca3e342c26e92b50&token=816772476&lang=zh_CN#rd">10 分钟搞定 SpringBoot 如何优雅读取配置文件？</a>》 。</p><h3 id=6-参数校验>6. 参数校验</h3><p><strong>数据的校验的重要性就不用说了，即使在前端对数据进行校验的情况下，我们还是要对传入后端的数据再进行一遍校验，避免用户绕过浏览器直接通过一些 HTTP 工具直接向后端请求一些违法数据。</strong></p><p><strong>JSR(Java Specification Requests）</strong> 是一套 JavaBean 参数校验的标准，它定义了很多常用的校验注解，我们可以直接将这些注解加在我们 JavaBean 的属性上面，这样就可以在需要校验的时候进行校验了，非常方便！</p><p>校验的时候我们实际用的是 <strong>Hibernate Validator</strong> 框架。Hibernate Validator 是 Hibernate 团队最初的数据校验框架，Hibernate Validator 4.x 是 Bean Validation 1.0（JSR 303）的参考实现，Hibernate Validator 5.x 是 Bean Validation 1.1（JSR 349）的参考实现，目前最新版的 Hibernate Validator 6.x 是 Bean Validation 2.0（JSR 380）的参考实现。</p><p>SpringBoot 项目的 spring-boot-starter-web 依赖中已经有 hibernate-validator 包，不需要引用相关依赖。如下图所示（通过 idea 插件—Maven Helper 生成）：</p><p><img src=/images/20200424113300.png alt></p><p>非 SpringBoot 项目需要自行引入相关依赖包，这里不多做讲解，具体可以查看我的这篇文章：《<a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247485783&idx=1&sn=a407f3b75efa17c643407daa7fb2acd6&chksm=cea2469cf9d5cf8afbcd0a8a1c9cc4294d6805b8e01bee6f76bb2884c5bc15478e91459def49&token=292197051&lang=zh_CN#rd">如何在 Spring/Spring Boot 中做参数校验？你需要了解的都在这里！</a>》。</p><p>👉 需要注意的是： <strong>所有的注解，推荐使用 JSR 注解，即<code>javax.validation.constraints</code>，而不是<code>org.hibernate.validator.constraints</code></strong></p><h4 id=61-一些常用的字段验证的注解>6.1. 一些常用的字段验证的注解</h4><ul><li><code>@NotEmpty</code> 被注释的字符串的不能为 null 也不能为空</li><li><code>@NotBlank</code> 被注释的字符串非 null，并且必须包含一个非空白字符</li><li><code>@Null</code> 被注释的元素必须为 null</li><li><code>@NotNull</code> 被注释的元素必须不为 null</li><li><code>@AssertTrue</code> 被注释的元素必须为 true</li><li><code>@AssertFalse</code> 被注释的元素必须为 false</li><li><code>@Pattern(regex=,flag=)</code>被注释的元素必须符合指定的正则表达式</li><li><code>@Email</code> 被注释的元素必须是 Email 格式。</li><li><code>@Min(value)</code>被注释的元素必须是一个数字，其值必须大于等于指定的最小值</li><li><code>@Max(value)</code>被注释的元素必须是一个数字，其值必须小于等于指定的最大值</li><li><code>@DecimalMin(value)</code>被注释的元素必须是一个数字，其值必须大于等于指定的最小值</li><li><code>@DecimalMax(value)</code> 被注释的元素必须是一个数字，其值必须小于等于指定的最大值</li><li><code>@Size(max=, min=)</code>被注释的元素的大小必须在指定的范围内</li><li><code>@Digits (integer, fraction)</code>被注释的元素必须是一个数字，其值必须在可接受的范围内</li><li><code>@Past</code>被注释的元素必须是一个过去的日期</li><li><code>@Future</code> 被注释的元素必须是一个将来的日期</li><li>&mldr;&mldr;</li></ul><h4 id=62-验证请求体requestbody>6.2. 验证请求体(RequestBody)</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Data</span>
<span class=nd>@AllArgsConstructor</span>
<span class=nd>@NoArgsConstructor</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Person</span> <span class=o>{</span>

    <span class=nd>@NotNull</span><span class=o>(</span><span class=n>message</span> <span class=o>=</span> <span class=s>&#34;classId 不能为空&#34;</span><span class=o>)</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>classId</span><span class=o>;</span>

    <span class=nd>@Size</span><span class=o>(</span><span class=n>max</span> <span class=o>=</span> <span class=n>33</span><span class=o>)</span>
    <span class=nd>@NotNull</span><span class=o>(</span><span class=n>message</span> <span class=o>=</span> <span class=s>&#34;name 不能为空&#34;</span><span class=o>)</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>

    <span class=nd>@Pattern</span><span class=o>(</span><span class=n>regexp</span> <span class=o>=</span> <span class=s>&#34;((^Man$|^Woman$|^UGM$))&#34;</span><span class=o>,</span> <span class=n>message</span> <span class=o>=</span> <span class=s>&#34;sex 值不在可选范围&#34;</span><span class=o>)</span>
    <span class=nd>@NotNull</span><span class=o>(</span><span class=n>message</span> <span class=o>=</span> <span class=s>&#34;sex 不能为空&#34;</span><span class=o>)</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>sex</span><span class=o>;</span>

    <span class=nd>@Email</span><span class=o>(</span><span class=n>message</span> <span class=o>=</span> <span class=s>&#34;email 格式不正确&#34;</span><span class=o>)</span>
    <span class=nd>@NotNull</span><span class=o>(</span><span class=n>message</span> <span class=o>=</span> <span class=s>&#34;email 不能为空&#34;</span><span class=o>)</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>email</span><span class=o>;</span>

<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>我们在需要验证的参数上加上了<code>@Valid</code>注解，如果验证失败，它将抛出<code>MethodArgumentNotValidException</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@RestController</span>
<span class=nd>@RequestMapping</span><span class=o>(</span><span class=s>&#34;/api&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>PersonController</span> <span class=o>{</span>

    <span class=nd>@PostMapping</span><span class=o>(</span><span class=s>&#34;/person&#34;</span><span class=o>)</span>
    <span class=kd>public</span> <span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>Person</span><span class=o>&gt;</span> <span class=nf>getPerson</span><span class=o>(</span><span class=nd>@RequestBody</span> <span class=nd>@Valid</span> <span class=n>Person</span> <span class=n>person</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>ResponseEntity</span><span class=o>.</span><span class=na>ok</span><span class=o>().</span><span class=na>body</span><span class=o>(</span><span class=n>person</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><h4 id=63-验证请求参数path-variables-和-request-parameters>6.3. 验证请求参数(Path Variables 和 Request Parameters)</h4><p><strong>一定一定不要忘记在类上加上 <code>Validated</code> 注解了，这个参数可以告诉 Spring 去校验方法参数。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@RestController</span>
<span class=nd>@RequestMapping</span><span class=o>(</span><span class=s>&#34;/api&#34;</span><span class=o>)</span>
<span class=nd>@Validated</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>PersonController</span> <span class=o>{</span>

    <span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/person/{id}&#34;</span><span class=o>)</span>
    <span class=kd>public</span> <span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=nf>getPersonByID</span><span class=o>(</span><span class=nd>@Valid</span> <span class=nd>@PathVariable</span><span class=o>(</span><span class=s>&#34;id&#34;</span><span class=o>)</span> <span class=nd>@Max</span><span class=o>(</span><span class=n>value</span> <span class=o>=</span> <span class=n>5</span><span class=o>,</span><span class=n>message</span> <span class=o>=</span> <span class=s>&#34;超过 id 的范围了&#34;</span><span class=o>)</span> <span class=n>Integer</span> <span class=n>id</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>ResponseEntity</span><span class=o>.</span><span class=na>ok</span><span class=o>().</span><span class=na>body</span><span class=o>(</span><span class=n>id</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>更多关于如何在 Spring 项目中进行参数校验的内容，请看《<a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247485783&idx=1&sn=a407f3b75efa17c643407daa7fb2acd6&chksm=cea2469cf9d5cf8afbcd0a8a1c9cc4294d6805b8e01bee6f76bb2884c5bc15478e91459def49&token=292197051&lang=zh_CN#rd">如何在 Spring/Spring Boot 中做参数校验？你需要了解的都在这里！</a>》这篇文章。</p><h3 id=7-全局处理-controller-层异常>7. 全局处理 Controller 层异常</h3><p>介绍一下我们 Spring 项目必备的全局处理 Controller 层异常。</p><p><strong>相关注解：</strong></p><ol><li><code>@ControllerAdvice</code> :注解定义全局异常处理类</li><li><code>@ExceptionHandler</code> :注解声明异常处理方法</li></ol><p>如何使用呢？拿我们在第 5 节参数校验这块来举例子。如果方法参数不对的话就会抛出<code>MethodArgumentNotValidException</code>，我们来处理这个异常。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@ControllerAdvice</span>
<span class=nd>@ResponseBody</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>GlobalExceptionHandler</span> <span class=o>{</span>

    <span class=cm>/**
</span><span class=cm>     * 请求参数异常处理
</span><span class=cm>     */</span>
    <span class=nd>@ExceptionHandler</span><span class=o>(</span><span class=n>MethodArgumentNotValidException</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
    <span class=kd>public</span> <span class=n>ResponseEntity</span><span class=o>&lt;?&gt;</span> <span class=n>handleMethodArgumentNotValidException</span><span class=o>(</span><span class=n>MethodArgumentNotValidException</span> <span class=n>ex</span><span class=o>,</span> <span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>)</span> <span class=o>{</span>
       <span class=o>......</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>更多关于 Spring Boot 异常处理的内容，请看我的这两篇文章：</p><ol><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247485568&idx=2&sn=c5ba880fd0c5d82e39531fa42cb036ac&chksm=cea2474bf9d5ce5dcbc6a5f6580198fdce4bc92ef577579183a729cb5d1430e4994720d59b34&token=2133161636&lang=zh_CN#rd">SpringBoot 处理异常的几种常见姿势</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247486379&idx=2&sn=48c29ae65b3ed874749f0803f0e4d90e&chksm=cea24460f9d5cd769ed53ad7e17c97a7963a89f5350e370be633db0ae8d783c3a3dbd58c70f8&token=1054498516&lang=zh_CN#rd">使用枚举简单封装一个优雅的 Spring Boot 全局异常处理！</a></li></ol><h3 id=8-jpa-相关>8. JPA 相关</h3><h4 id=81-创建表>8.1. 创建表</h4><p><code>@Entity</code>声明一个类对应一个数据库实体。</p><p><code>@Table</code> 设置表明</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Entity</span>
<span class=nd>@Table</span><span class=o>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;role&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Role</span> <span class=o>{</span>
    <span class=nd>@Id</span>
    <span class=nd>@GeneratedValue</span><span class=o>(</span><span class=n>strategy</span> <span class=o>=</span> <span class=n>GenerationType</span><span class=o>.</span><span class=na>IDENTITY</span><span class=o>)</span>
    <span class=kd>private</span> <span class=n>Long</span> <span class=n>id</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>description</span><span class=o>;</span>
    <span class=n>省略getter</span><span class=o>/</span><span class=n>setter</span><span class=o>......</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><h4 id=82-创建主键>8.2. 创建主键</h4><p><code>@Id</code> ：声明一个字段为主键。</p><p>使用<code>@Id</code>声明之后，我们还需要定义主键的生成策略。我们可以使用 <code>@GeneratedValue</code> 指定主键生成策略。</p><p><strong>1.通过 <code>@GeneratedValue</code>直接使用 JPA 内置提供的四种主键生成策略来指定主键生成策略。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Id</span>
<span class=nd>@GeneratedValue</span><span class=o>(</span><span class=n>strategy</span> <span class=o>=</span> <span class=n>GenerationType</span><span class=o>.</span><span class=na>IDENTITY</span><span class=o>)</span>
<span class=kd>private</span> <span class=n>Long</span> <span class=n>id</span><span class=o>;</span>
</code></pre></td></tr></table></div></div><p>JPA 使用枚举定义了 4 中常见的主键生成策略，如下：</p><p><em>Guide 哥：枚举替代常量的一种用法</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>enum</span> <span class=n>GenerationType</span> <span class=o>{</span>

    <span class=cm>/**
</span><span class=cm>     * 使用一个特定的数据库表格来保存主键
</span><span class=cm>     * 持久化引擎通过关系数据库的一张特定的表格来生成主键,
</span><span class=cm>     */</span>
    <span class=n>TABLE</span><span class=o>,</span>

    <span class=cm>/**
</span><span class=cm>     *在某些数据库中,不支持主键自增长,比如Oracle、PostgreSQL其提供了一种叫做&#34;序列(sequence)&#34;的机制生成主键
</span><span class=cm>     */</span>
    <span class=n>SEQUENCE</span><span class=o>,</span>

    <span class=cm>/**
</span><span class=cm>     * 主键自增长
</span><span class=cm>     */</span>
    <span class=n>IDENTITY</span><span class=o>,</span>

    <span class=cm>/**
</span><span class=cm>     *把主键生成策略交给持久化引擎(persistence engine),
</span><span class=cm>     *持久化引擎会根据数据库在以上三种主键生成 策略中选择其中一种
</span><span class=cm>     */</span>
    <span class=n>AUTO</span>
<span class=o>}</span>

</code></pre></td></tr></table></div></div><p><code>@GeneratedValue</code>注解默认使用的策略是<code>GenerationType.AUTO</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=nd>@interface</span> <span class=n>GeneratedValue</span> <span class=o>{</span>

    <span class=n>GenerationType</span> <span class=nf>strategy</span><span class=o>()</span> <span class=k>default</span> <span class=n>AUTO</span><span class=o>;</span>
    <span class=n>String</span> <span class=nf>generator</span><span class=o>()</span> <span class=k>default</span> <span class=s>&#34;&#34;</span><span class=o>;</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>一般使用 MySQL 数据库的话，使用<code>GenerationType.IDENTITY</code>策略比较普遍一点（分布式系统的话需要另外考虑使用分布式 ID）。</p><p><strong>2.通过 <code>@GenericGenerator</code>声明一个主键策略，然后 <code>@GeneratedValue</code>使用这个策略</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Id</span>
<span class=nd>@GeneratedValue</span><span class=o>(</span><span class=n>generator</span> <span class=o>=</span> <span class=s>&#34;IdentityIdGenerator&#34;</span><span class=o>)</span>
<span class=nd>@GenericGenerator</span><span class=o>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;IdentityIdGenerator&#34;</span><span class=o>,</span> <span class=n>strategy</span> <span class=o>=</span> <span class=s>&#34;identity&#34;</span><span class=o>)</span>
<span class=kd>private</span> <span class=n>Long</span> <span class=n>id</span><span class=o>;</span>
</code></pre></td></tr></table></div></div><p>等价于：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Id</span>
<span class=nd>@GeneratedValue</span><span class=o>(</span><span class=n>strategy</span> <span class=o>=</span> <span class=n>GenerationType</span><span class=o>.</span><span class=na>IDENTITY</span><span class=o>)</span>
<span class=kd>private</span> <span class=n>Long</span> <span class=n>id</span><span class=o>;</span>
</code></pre></td></tr></table></div></div><p>jpa 提供的主键生成策略有如下几种：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>DefaultIdentifierGeneratorFactory</span>
		<span class=kd>implements</span> <span class=n>MutableIdentifierGeneratorFactory</span><span class=o>,</span> <span class=n>Serializable</span><span class=o>,</span> <span class=n>ServiceRegistryAwareService</span> <span class=o>{</span>

	<span class=nd>@SuppressWarnings</span><span class=o>(</span><span class=s>&#34;deprecation&#34;</span><span class=o>)</span>
	<span class=kd>public</span> <span class=nf>DefaultIdentifierGeneratorFactory</span><span class=o>()</span> <span class=o>{</span>
		<span class=n>register</span><span class=o>(</span> <span class=s>&#34;uuid2&#34;</span><span class=o>,</span> <span class=n>UUIDGenerator</span><span class=o>.</span><span class=na>class</span> <span class=o>);</span>
		<span class=n>register</span><span class=o>(</span> <span class=s>&#34;guid&#34;</span><span class=o>,</span> <span class=n>GUIDGenerator</span><span class=o>.</span><span class=na>class</span> <span class=o>);</span>			<span class=c1>// can be done with UUIDGenerator + strategy
</span><span class=c1></span>		<span class=n>register</span><span class=o>(</span> <span class=s>&#34;uuid&#34;</span><span class=o>,</span> <span class=n>UUIDHexGenerator</span><span class=o>.</span><span class=na>class</span> <span class=o>);</span>			<span class=c1>// &#34;deprecated&#34; for new use
</span><span class=c1></span>		<span class=n>register</span><span class=o>(</span> <span class=s>&#34;uuid.hex&#34;</span><span class=o>,</span> <span class=n>UUIDHexGenerator</span><span class=o>.</span><span class=na>class</span> <span class=o>);</span> 	<span class=c1>// uuid.hex is deprecated
</span><span class=c1></span>		<span class=n>register</span><span class=o>(</span> <span class=s>&#34;assigned&#34;</span><span class=o>,</span> <span class=n>Assigned</span><span class=o>.</span><span class=na>class</span> <span class=o>);</span>
		<span class=n>register</span><span class=o>(</span> <span class=s>&#34;identity&#34;</span><span class=o>,</span> <span class=n>IdentityGenerator</span><span class=o>.</span><span class=na>class</span> <span class=o>);</span>
		<span class=n>register</span><span class=o>(</span> <span class=s>&#34;select&#34;</span><span class=o>,</span> <span class=n>SelectGenerator</span><span class=o>.</span><span class=na>class</span> <span class=o>);</span>
		<span class=n>register</span><span class=o>(</span> <span class=s>&#34;sequence&#34;</span><span class=o>,</span> <span class=n>SequenceStyleGenerator</span><span class=o>.</span><span class=na>class</span> <span class=o>);</span>
		<span class=n>register</span><span class=o>(</span> <span class=s>&#34;seqhilo&#34;</span><span class=o>,</span> <span class=n>SequenceHiLoGenerator</span><span class=o>.</span><span class=na>class</span> <span class=o>);</span>
		<span class=n>register</span><span class=o>(</span> <span class=s>&#34;increment&#34;</span><span class=o>,</span> <span class=n>IncrementGenerator</span><span class=o>.</span><span class=na>class</span> <span class=o>);</span>
		<span class=n>register</span><span class=o>(</span> <span class=s>&#34;foreign&#34;</span><span class=o>,</span> <span class=n>ForeignGenerator</span><span class=o>.</span><span class=na>class</span> <span class=o>);</span>
		<span class=n>register</span><span class=o>(</span> <span class=s>&#34;sequence-identity&#34;</span><span class=o>,</span> <span class=n>SequenceIdentityGenerator</span><span class=o>.</span><span class=na>class</span> <span class=o>);</span>
		<span class=n>register</span><span class=o>(</span> <span class=s>&#34;enhanced-sequence&#34;</span><span class=o>,</span> <span class=n>SequenceStyleGenerator</span><span class=o>.</span><span class=na>class</span> <span class=o>);</span>
		<span class=n>register</span><span class=o>(</span> <span class=s>&#34;enhanced-table&#34;</span><span class=o>,</span> <span class=n>TableGenerator</span><span class=o>.</span><span class=na>class</span> <span class=o>);</span>
	<span class=o>}</span>

	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>register</span><span class=o>(</span><span class=n>String</span> <span class=n>strategy</span><span class=o>,</span> <span class=n>Class</span> <span class=n>generatorClass</span><span class=o>)</span> <span class=o>{</span>
		<span class=n>LOG</span><span class=o>.</span><span class=na>debugf</span><span class=o>(</span> <span class=s>&#34;Registering IdentifierGenerator strategy [%s] -&gt; [%s]&#34;</span><span class=o>,</span> <span class=n>strategy</span><span class=o>,</span> <span class=n>generatorClass</span><span class=o>.</span><span class=na>getName</span><span class=o>()</span> <span class=o>);</span>
		<span class=kd>final</span> <span class=n>Class</span> <span class=n>previous</span> <span class=o>=</span> <span class=n>generatorStrategyToClassNameMap</span><span class=o>.</span><span class=na>put</span><span class=o>(</span> <span class=n>strategy</span><span class=o>,</span> <span class=n>generatorClass</span> <span class=o>);</span>
		<span class=k>if</span> <span class=o>(</span> <span class=n>previous</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>)</span> <span class=o>{</span>
			<span class=n>LOG</span><span class=o>.</span><span class=na>debugf</span><span class=o>(</span> <span class=s>&#34;    - overriding [%s]&#34;</span><span class=o>,</span> <span class=n>previous</span><span class=o>.</span><span class=na>getName</span><span class=o>()</span> <span class=o>);</span>
		<span class=o>}</span>
	<span class=o>}</span>

<span class=o>}</span>
</code></pre></td></tr></table></div></div><h4 id=83-设置字段类型>8.3. 设置字段类型</h4><p><code>@Column</code> 声明字段。</p><p><strong>示例：</strong></p><p>设置属性 userName 对应的数据库字段名为 user_name，长度为 32，非空</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Column</span><span class=o>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;user_name&#34;</span><span class=o>,</span> <span class=n>nullable</span> <span class=o>=</span> <span class=kc>false</span><span class=o>,</span> <span class=n>length</span><span class=o>=</span><span class=n>32</span><span class=o>)</span>
<span class=kd>private</span> <span class=n>String</span> <span class=n>userName</span><span class=o>;</span>
</code></pre></td></tr></table></div></div><p>设置字段类型并且加默认值，这个还是挺常用的。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>Column</span><span class=o>(</span><span class=n>columnDefinition</span> <span class=o>=</span> <span class=s>&#34;tinyint(1) default 1&#34;</span><span class=o>)</span>
<span class=kd>private</span> <span class=n>Boolean</span> <span class=n>enabled</span><span class=o>;</span>
</code></pre></td></tr></table></div></div><h4 id=84-指定不持久化特定字段>8.4. 指定不持久化特定字段</h4><p><code>@Transient</code> ：声明不需要与数据库映射的字段，在保存的时候不需要保存进数据库 。</p><p>如果我们想让<code>secrect</code> 这个字段不被持久化，可以使用 <code>@Transient</code>关键字声明。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>Entity</span><span class=o>(</span><span class=n>name</span><span class=o>=</span><span class=s>&#34;USER&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>User</span> <span class=o>{</span>

    <span class=o>......</span>
    <span class=nd>@Transient</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>secrect</span><span class=o>;</span> <span class=c1>// not persistent because of @Transient
</span><span class=c1></span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>除了 <code>@Transient</code>关键字声明， 还可以采用下面几种方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>static</span> <span class=n>String</span> <span class=n>secrect</span><span class=o>;</span> <span class=c1>// not persistent because of static
</span><span class=c1></span><span class=kd>final</span> <span class=n>String</span> <span class=n>secrect</span> <span class=o>=</span> <span class=err>“</span><span class=n>Satish</span><span class=err>”</span><span class=o>;</span> <span class=c1>// not persistent because of final
</span><span class=c1></span><span class=kd>transient</span> <span class=n>String</span> <span class=n>secrect</span><span class=o>;</span> <span class=c1>// not persistent because of transient
</span></code></pre></td></tr></table></div></div><p>一般使用注解的方式比较多。</p><h4 id=85-声明大字段>8.5. 声明大字段</h4><p><code>@Lob</code>:声明某个字段为大字段。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Lob</span>
<span class=kd>private</span> <span class=n>String</span> <span class=n>content</span><span class=o>;</span>
</code></pre></td></tr></table></div></div><p>更详细的声明：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Lob</span>
<span class=c1>//指定 Lob 类型数据的获取策略， FetchType.EAGER 表示非延迟 加载，而 FetchType. LAZY 表示延迟加载 ；
</span><span class=c1></span><span class=nd>@Basic</span><span class=o>(</span><span class=n>fetch</span> <span class=o>=</span> <span class=n>FetchType</span><span class=o>.</span><span class=na>EAGER</span><span class=o>)</span>
<span class=c1>//columnDefinition 属性指定数据表对应的 Lob 字段类型
</span><span class=c1></span><span class=nd>@Column</span><span class=o>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;content&#34;</span><span class=o>,</span> <span class=n>columnDefinition</span> <span class=o>=</span> <span class=s>&#34;LONGTEXT NOT NULL&#34;</span><span class=o>)</span>
<span class=kd>private</span> <span class=n>String</span> <span class=n>content</span><span class=o>;</span>
</code></pre></td></tr></table></div></div><h4 id=86-创建枚举类型的字段>8.6. 创建枚举类型的字段</h4><p>可以使用枚举类型的字段，不过枚举字段要用<code>@Enumerated</code>注解修饰。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>enum</span> <span class=n>Gender</span> <span class=o>{</span>
    <span class=n>MALE</span><span class=o>(</span><span class=s>&#34;男性&#34;</span><span class=o>),</span>
    <span class=n>FEMALE</span><span class=o>(</span><span class=s>&#34;女性&#34;</span><span class=o>);</span>

    <span class=kd>private</span> <span class=n>String</span> <span class=n>value</span><span class=o>;</span>
    <span class=n>Gender</span><span class=o>(</span><span class=n>String</span> <span class=n>str</span><span class=o>){</span>
        <span class=n>value</span><span class=o>=</span><span class=n>str</span><span class=o>;</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Entity</span>
<span class=nd>@Table</span><span class=o>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;role&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Role</span> <span class=o>{</span>
    <span class=nd>@Id</span>
    <span class=nd>@GeneratedValue</span><span class=o>(</span><span class=n>strategy</span> <span class=o>=</span> <span class=n>GenerationType</span><span class=o>.</span><span class=na>IDENTITY</span><span class=o>)</span>
    <span class=kd>private</span> <span class=n>Long</span> <span class=n>id</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>description</span><span class=o>;</span>
    <span class=nd>@Enumerated</span><span class=o>(</span><span class=n>EnumType</span><span class=o>.</span><span class=na>STRING</span><span class=o>)</span>
    <span class=kd>private</span> <span class=n>Gender</span> <span class=n>gender</span><span class=o>;</span>
    <span class=n>省略getter</span><span class=o>/</span><span class=n>setter</span><span class=o>......</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>数据库里面对应存储的是 MAIL/FEMAIL。</p><h4 id=87-增加审计功能>8.7. 增加审计功能</h4><p>只要继承了 <code>AbstractAuditBase</code>的类都会默认加上下面四个字段。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Data</span>
<span class=nd>@AllArgsConstructor</span>
<span class=nd>@NoArgsConstructor</span>
<span class=nd>@MappedSuperclass</span>
<span class=nd>@EntityListeners</span><span class=o>(</span><span class=n>value</span> <span class=o>=</span> <span class=n>AuditingEntityListener</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
<span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>AbstractAuditBase</span> <span class=o>{</span>

    <span class=nd>@CreatedDate</span>
    <span class=nd>@Column</span><span class=o>(</span><span class=n>updatable</span> <span class=o>=</span> <span class=kc>false</span><span class=o>)</span>
    <span class=nd>@JsonIgnore</span>
    <span class=kd>private</span> <span class=n>Instant</span> <span class=n>createdAt</span><span class=o>;</span>

    <span class=nd>@LastModifiedDate</span>
    <span class=nd>@JsonIgnore</span>
    <span class=kd>private</span> <span class=n>Instant</span> <span class=n>updatedAt</span><span class=o>;</span>

    <span class=nd>@CreatedBy</span>
    <span class=nd>@Column</span><span class=o>(</span><span class=n>updatable</span> <span class=o>=</span> <span class=kc>false</span><span class=o>)</span>
    <span class=nd>@JsonIgnore</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>createdBy</span><span class=o>;</span>

    <span class=nd>@LastModifiedBy</span>
    <span class=nd>@JsonIgnore</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>updatedBy</span><span class=o>;</span>
<span class=o>}</span>

</code></pre></td></tr></table></div></div><p>我们对应的审计功能对应地配置类可能是下面这样的（Spring Security 项目）:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java>
<span class=nd>@Configuration</span>
<span class=nd>@EnableJpaAuditing</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>AuditSecurityConfiguration</span> <span class=o>{</span>
    <span class=nd>@Bean</span>
    <span class=n>AuditorAware</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>auditorAware</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=o>()</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=o>.</span><span class=na>ofNullable</span><span class=o>(</span><span class=n>SecurityContextHolder</span><span class=o>.</span><span class=na>getContext</span><span class=o>())</span>
                <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>SecurityContext</span><span class=o>::</span><span class=n>getAuthentication</span><span class=o>)</span>
                <span class=o>.</span><span class=na>filter</span><span class=o>(</span><span class=n>Authentication</span><span class=o>::</span><span class=n>isAuthenticated</span><span class=o>)</span>
                <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>Authentication</span><span class=o>::</span><span class=n>getName</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>简单介绍一下上面设计到的一些注解：</p><ol><li><p><code>@CreatedDate</code>: 表示该字段为创建时间时间字段，在这个实体被 insert 的时候，会设置值</p></li><li><p><code>@CreatedBy</code> :表示该字段为创建人，在这个实体被 insert 的时候，会设置值</p><p><code>@LastModifiedDate</code>、<code>@LastModifiedBy</code>同理。</p></li></ol><p><code>@EnableJpaAuditing</code>：开启 JPA 审计功能。</p><h4 id=88-删除修改数据>8.8. 删除/修改数据</h4><p><code>@Modifying</code> 注解提示 JPA 该操作是修改操作,注意还要配合<code>@Transactional</code>注解使用。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Repository</span>
<span class=kd>public</span> <span class=kd>interface</span> <span class=nc>UserRepository</span> <span class=kd>extends</span> <span class=n>JpaRepository</span><span class=o>&lt;</span><span class=n>User</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;</span> <span class=o>{</span>

    <span class=nd>@Modifying</span>
    <span class=nd>@Transactional</span><span class=o>(</span><span class=n>rollbackFor</span> <span class=o>=</span> <span class=n>Exception</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
    <span class=kt>void</span> <span class=nf>deleteByUserName</span><span class=o>(</span><span class=n>String</span> <span class=n>userName</span><span class=o>);</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><h4 id=89-关联关系>8.9. 关联关系</h4><ul><li><code>@OneToOne</code> 声明一对一关系</li><li><code>@OneToMany</code> 声明一对多关系</li><li><code>@ManyToOne</code>声明多对一关系</li><li><code>MangToMang</code>声明多对多关系</li></ul><p>更多关于 Spring Boot JPA 的文章请看我的这篇文章：<a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247485689&idx=1&sn=061b32c2222869932be5631fb0bb5260&chksm=cea24732f9d5ce24a356fb3675170e7843addbfcc79ee267cfdb45c83fc7e90babf0f20d22e1&token=292197051&lang=zh_CN#rd">一文搞懂如何在 Spring Boot 正确中使用 JPA</a> 。</p><h3 id=9-事务-transactional>9. 事务 <code>@Transactional</code></h3><p>在要开启事务的方法上使用<code>@Transactional</code>注解即可!</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Transactional</span><span class=o>(</span><span class=n>rollbackFor</span> <span class=o>=</span> <span class=n>Exception</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
<span class=kd>public</span> <span class=kt>void</span> <span class=nf>save</span><span class=o>()</span> <span class=o>{</span>
  <span class=o>......</span>
<span class=o>}</span>

</code></pre></td></tr></table></div></div><p>我们知道 Exception 分为运行时异常 RuntimeException 和非运行时异常。在<code>@Transactional</code>注解中如果不配置<code>rollbackFor</code>属性,那么事物只会在遇到<code>RuntimeException</code>的时候才会回滚,加上<code>rollbackFor=Exception.class</code>,可以让事物在遇到非运行时异常时也回滚。</p><p><code>@Transactional</code> 注解一般用在可以作用在<code>类</code>或者<code>方法</code>上。</p><ul><li><strong>作用于类</strong>：当把<code>@Transactional 注解放在类上时，表示所有该类的</code>public 方法都配置相同的事务属性信息。</li><li><strong>作用于方法</strong>：当类配置了<code>@Transactional</code>，方法也配置了<code>@Transactional</code>，方法的事务会覆盖类的事务配置信息。</li></ul><p>更多关于关于 Spring 事务的内容请查看：</p><ol><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247484943&idx=1&sn=46b9082af4ec223137df7d1c8303ca24&chksm=cea249c4f9d5c0d2b8212a17252cbfb74e5fbe5488b76d829827421c53332326d1ec360f5d63&token=1082669959&lang=zh_CN#rd">可能是最漂亮的 Spring 事务管理详解</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247486483&idx=2&sn=77be488e206186803531ea5d7164ec53&chksm=cea243d8f9d5cacecaa5c5daae4cde4c697b9b5b21f96dfc6cce428cfcb62b88b3970c26b9c2&token=816772476&lang=zh_CN#rd">一口气说出 6 种 @Transactional 注解失效场景</a></li></ol><h3 id=10-json-数据处理>10. json 数据处理</h3><h4 id=101-过滤-json-数据>10.1. 过滤 json 数据</h4><p><strong><code>@JsonIgnoreProperties</code> 作用在类上用于过滤掉特定字段不返回或者不解析。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=c1>//生成json时将userRoles属性过滤
</span><span class=c1></span><span class=nd>@JsonIgnoreProperties</span><span class=o>({</span><span class=s>&#34;userRoles&#34;</span><span class=o>})</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>User</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=n>String</span> <span class=n>userName</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>fullName</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>password</span><span class=o>;</span>
    <span class=nd>@JsonIgnore</span>
    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>UserRole</span><span class=o>&gt;</span> <span class=n>userRoles</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p><strong><code>@JsonIgnore</code>一般用于类的属性上，作用和上面的<code>@JsonIgnoreProperties</code> 一样。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>User</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=n>String</span> <span class=n>userName</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>fullName</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>password</span><span class=o>;</span>
   <span class=c1>//生成json时将userRoles属性过滤
</span><span class=c1></span>    <span class=nd>@JsonIgnore</span>
    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>UserRole</span><span class=o>&gt;</span> <span class=n>userRoles</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><h4 id=102-格式化-json-数据>10.2. 格式化 json 数据</h4><p><code>@JsonFormat</code>一般用来格式化 json 数据。：</p><p>比如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@JsonFormat</span><span class=o>(</span><span class=n>shape</span><span class=o>=</span><span class=n>JsonFormat</span><span class=o>.</span><span class=na>Shape</span><span class=o>.</span><span class=na>STRING</span><span class=o>,</span> <span class=n>pattern</span><span class=o>=</span><span class=s>&#34;yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSS&#39;Z&#39;&#34;</span><span class=o>,</span> <span class=n>timezone</span><span class=o>=</span><span class=s>&#34;GMT&#34;</span><span class=o>)</span>
<span class=kd>private</span> <span class=n>Date</span> <span class=n>date</span><span class=o>;</span>
</code></pre></td></tr></table></div></div><h4 id=103-扁平化对象>10.3. 扁平化对象</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Getter</span>
<span class=nd>@Setter</span>
<span class=nd>@ToString</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Account</span> <span class=o>{</span>
    <span class=nd>@JsonUnwrapped</span>
    <span class=kd>private</span> <span class=n>Location</span> <span class=n>location</span><span class=o>;</span>
    <span class=nd>@JsonUnwrapped</span>
    <span class=kd>private</span> <span class=n>PersonInfo</span> <span class=n>personInfo</span><span class=o>;</span>

  <span class=nd>@Getter</span>
  <span class=nd>@Setter</span>
  <span class=nd>@ToString</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>Location</span> <span class=o>{</span>
     <span class=kd>private</span> <span class=n>String</span> <span class=n>provinceName</span><span class=o>;</span>
     <span class=kd>private</span> <span class=n>String</span> <span class=n>countyName</span><span class=o>;</span>
  <span class=o>}</span>
  <span class=nd>@Getter</span>
  <span class=nd>@Setter</span>
  <span class=nd>@ToString</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>PersonInfo</span> <span class=o>{</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>userName</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>fullName</span><span class=o>;</span>
  <span class=o>}</span>
<span class=o>}</span>

</code></pre></td></tr></table></div></div><p>未扁平化之前：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
    <span class=nt>&#34;location&#34;</span><span class=p>:</span> <span class=p>{</span>
        <span class=nt>&#34;provinceName&#34;</span><span class=p>:</span><span class=s2>&#34;湖北&#34;</span><span class=p>,</span>
        <span class=nt>&#34;countyName&#34;</span><span class=p>:</span><span class=s2>&#34;武汉&#34;</span>
    <span class=p>},</span>
    <span class=nt>&#34;personInfo&#34;</span><span class=p>:</span> <span class=p>{</span>
        <span class=nt>&#34;userName&#34;</span><span class=p>:</span> <span class=s2>&#34;coder1234&#34;</span><span class=p>,</span>
        <span class=nt>&#34;fullName&#34;</span><span class=p>:</span> <span class=s2>&#34;shaungkou&#34;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>使用<code>@JsonUnwrapped</code> 扁平对象之后：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Getter</span>
<span class=nd>@Setter</span>
<span class=nd>@ToString</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Account</span> <span class=o>{</span>
    <span class=nd>@JsonUnwrapped</span>
    <span class=kd>private</span> <span class=n>Location</span> <span class=n>location</span><span class=o>;</span>
    <span class=nd>@JsonUnwrapped</span>
    <span class=kd>private</span> <span class=n>PersonInfo</span> <span class=n>personInfo</span><span class=o>;</span>
    <span class=o>......</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
  <span class=nt>&#34;provinceName&#34;</span><span class=p>:</span><span class=s2>&#34;湖北&#34;</span><span class=p>,</span>
  <span class=nt>&#34;countyName&#34;</span><span class=p>:</span><span class=s2>&#34;武汉&#34;</span><span class=p>,</span>
  <span class=nt>&#34;userName&#34;</span><span class=p>:</span> <span class=s2>&#34;coder1234&#34;</span><span class=p>,</span>
  <span class=nt>&#34;fullName&#34;</span><span class=p>:</span> <span class=s2>&#34;shaungkou&#34;</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><h3 id=11-测试相关>11. 测试相关</h3><p><strong><code>@ActiveProfiles</code>一般作用于测试类上， 用于声明生效的 Spring 配置文件。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@SpringBootTest</span><span class=o>(</span><span class=n>webEnvironment</span> <span class=o>=</span> <span class=n>RANDOM_PORT</span><span class=o>)</span>
<span class=nd>@ActiveProfiles</span><span class=o>(</span><span class=s>&#34;test&#34;</span><span class=o>)</span>
<span class=nd>@Slf4j</span>
<span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>TestBase</span> <span class=o>{</span>
  <span class=o>......</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p><strong><code>@Test</code>声明一个方法为测试方法</strong></p><p><strong><code>@Transactional</code>被声明的测试方法的数据会回滚，避免污染测试数据。</strong></p><p><strong><code>@WithMockUser</code> Spring Security 提供的，用来模拟一个真实用户，并且可以赋予权限。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java>    <span class=nd>@Test</span>
    <span class=nd>@Transactional</span>
    <span class=nd>@WithMockUser</span><span class=o>(</span><span class=n>username</span> <span class=o>=</span> <span class=s>&#34;user-id-18163138155&#34;</span><span class=o>,</span> <span class=n>authorities</span> <span class=o>=</span> <span class=s>&#34;ROLE_TEACHER&#34;</span><span class=o>)</span>
    <span class=kt>void</span> <span class=nf>should_import_student_success</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=o>......</span>
    <span class=o>}</span>
</code></pre></td></tr></table></div></div><p><em>暂时总结到这里吧！虽然花了挺长时间才写完，不过可能还是会一些常用的注解的被漏掉，所以，我将文章也同步到了 Github 上去，Github 地址： 欢迎完善！</em></p><p>本文已经收录进我的 75K Star 的 Java 开源项目 JavaGuide：<a href=https://github.com/Snailclimb/JavaGuide>https://github.com/Snailclimb/JavaGuide</a>。</p></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>Guide哥</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2020年04月24日 11:30:12</span></p><p class=copyright-item><span class=item-title>许可协议</span>
<span class=item-content><a href=https://github.com/Snailclimb/JavaGuide/blob/master/docs/system-design/framework/spring/spring-annotations.md target=_blank>Guide哥</a></span></p></div><footer class=post-footer><div class=post-tags><a href=https://blog.itning.top/tags/spring/>spring</a>
<a href=https://blog.itning.top/tags/annotations/>annotations</a></div><nav class=post-nav><a class=next href=/post/2020/04/12/%E9%80%9A%E8%BF%87explain%E6%9F%A5%E8%AF%A2%E5%88%86%E6%9E%90sql%E7%9A%84%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92/><span class="next-text nav-default">通过explain查询分析SQL的执行计划</span>
<span class="prev-text nav-mobile">下一篇</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"/></svg></i></a></nav></footer></article><div class="post bg-white"><script src=https://utteranc.es/client.js repo=itning/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div></div></main><footer id=footer class=footer><div class=icon-links><a href=mailto:itning@itning.top rel="me noopener" class=iconfont title=email><svg class="icon" viewBox="0 0 1451 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408 1361.641813S1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523L83.726336 1024H682.532949 753.579947 1348.948139L1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955C777.248 802.205449 742.347691 811.03081 718.063616 811.603883z"/></svg></a><a href=http://github.com/itning rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg></a><a href=https://blog.itning.top/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg></a></div><div class=copyright><span class=copyright-year>&copy;
2016 -
2020
<span class=heart><i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg></i></span><span class=author>itning
</span><script type=text/javascript>document.write(unescape("%3Cspan id='cnzz_stat_icon_1278714977'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1278714977%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script></span><span id=busuanzi_container>访客数/访问量：<span id=busuanzi_value_site_uv></span>/<span id=busuanzi_value_site_pv></span></span>
<span>黑ICP备17003448号</span></div></footer><div class=back-to-top id=back-to-top><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg></i></div></div><script src=https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js></script><script src=https://cdn.bootcss.com/slideout/1.0.1/slideout.min.js></script><script type=text/javascript src=/js/main.dee43230127a73d039a734510fa896c89c3c7ce0cf0be0c7a7433f8fd69b76dc.js crossorigin=anonymous></script><script type=text/javascript src=/js/load-photoswipe.js></script><script src=https://cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.js></script><script src=https://cdn.bootcss.com/photoswipe/4.1.3/photoswipe-ui-default.min.js></script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>