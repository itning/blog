<!doctype html><html lang=zh-cn itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>JVM系列2 Class文件格式 - itning</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=MobileOptimized content="width"><meta name=HandheldFriendly content="true"><meta name=applicable-device content="pc,mobile"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=mobile-web-app-capable content="yes"><meta name=author content="Gityuan"><meta name=description content="Java编译过程是将Java文件转换为Claaa文件，从而实现了跨平台的功能， 本文详细讲述Class文件结构。
 一、 概述 计算机只能识别0和1，所以大家编写的程序都需要经过编译器，转换为由0和1组成的二进制本地机器码(Native Code)。随着虚拟机的不断发展，很多程序语言开始选择与操作系统和机器指令集无关的格式作为编译后的存储格式（Class文件），从而实现”Write Once, Run Anywhere”。 Java设计之初，考虑后期能让Java虚拟机运行其他语言，目前有越来越多的其他语言都可以直接需要在Java虚拟机，虚拟机只能识别Class文件，至于是由何种语言编译而来的，虚拟机并不关心，如下图："><meta name=keywords content="itning,我们始终是路人,blog,java"><meta name=generator content="Hugo 0.68.1"><link rel=canonical href=https://blog.itning.top/post/2020/04/10/jvm%E7%B3%BB%E5%88%972-class%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/sass/jane.min.af20b78e95c84de86b00a0242a4a77bd2601700e1b250edf27537d957ac0041d.css integrity="sha256-ryC3jpXITehrAKAkKkp3vSYBcA4bJQ7fJ1N9lXrABB0=" media=screen crossorigin=anonymous><meta property="og:title" content="JVM系列2 Class文件格式"><meta property="og:description" content="Java编译过程是将Java文件转换为Claaa文件，从而实现了跨平台的功能， 本文详细讲述Class文件结构。

一、 概述
计算机只能识别0和1，所以大家编写的程序都需要经过编译器，转换为由0和1组成的二进制本地机器码(Native Code)。随着虚拟机的不断发展，很多程序语言开始选择与操作系统和机器指令集无关的格式作为编译后的存储格式（Class文件），从而实现”Write Once, Run Anywhere”。 Java设计之初，考虑后期能让Java虚拟机运行其他语言，目前有越来越多的其他语言都可以直接需要在Java虚拟机，虚拟机只能识别Class文件，至于是由何种语言编译而来的，虚拟机并不关心，如下图："><meta property="og:type" content="article"><meta property="og:url" content="https://blog.itning.top/post/2020/04/10/jvm%E7%B3%BB%E5%88%972-class%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/"><meta property="article:published_time" content="2020-04-10T11:02:39+08:00"><meta property="article:modified_time" content="2020-04-10T11:02:39+08:00"><meta itemprop=name content="JVM系列2 Class文件格式"><meta itemprop=description content="Java编译过程是将Java文件转换为Claaa文件，从而实现了跨平台的功能， 本文详细讲述Class文件结构。

一、 概述
计算机只能识别0和1，所以大家编写的程序都需要经过编译器，转换为由0和1组成的二进制本地机器码(Native Code)。随着虚拟机的不断发展，很多程序语言开始选择与操作系统和机器指令集无关的格式作为编译后的存储格式（Class文件），从而实现”Write Once, Run Anywhere”。 Java设计之初，考虑后期能让Java虚拟机运行其他语言，目前有越来越多的其他语言都可以直接需要在Java虚拟机，虚拟机只能识别Class文件，至于是由何种语言编译而来的，虚拟机并不关心，如下图："><meta itemprop=datePublished content="2020-04-10T11:02:39+08:00"><meta itemprop=dateModified content="2020-04-10T11:02:39+08:00"><meta itemprop=wordCount content="540"><meta itemprop=keywords content="JVM,"><meta name=twitter:card content="summary"><meta name=twitter:title content="JVM系列2 Class文件格式"><meta name=twitter:description content="Java编译过程是将Java文件转换为Claaa文件，从而实现了跨平台的功能， 本文详细讲述Class文件结构。

一、 概述
计算机只能识别0和1，所以大家编写的程序都需要经过编译器，转换为由0和1组成的二进制本地机器码(Native Code)。随着虚拟机的不断发展，很多程序语言开始选择与操作系统和机器指令集无关的格式作为编译后的存储格式（Class文件），从而实现”Write Once, Run Anywhere”。 Java设计之初，考虑后期能让Java虚拟机运行其他语言，目前有越来越多的其他语言都可以直接需要在Java虚拟机，虚拟机只能识别Class文件，至于是由何种语言编译而来的，虚拟机并不关心，如下图："><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>itning</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><li class=mobile-menu-item><a class=menu-item-link href=https://blog.itning.top/>主页</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://blog.itning.top/post/>归档</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://blog.itning.top/tags/>标签</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://blog.itning.top/categories/>分类</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://github.com/itning rel=noopener target=_blank>GitHub
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408 512.128C896 481.792 871.424 457.152 841.152 457.152z"/></svg></i></a></li></ul></nav><link href=https://cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.css rel=stylesheet><link href=https://cdn.bootcss.com/photoswipe/4.1.3/default-skin/default-skin.min.css rel=stylesheet><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header id=header class="header container"><div class=logo-wrapper><a href=/ class=logo>itning</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=https://blog.itning.top/>主页</a></li><li class=menu-item><a class=menu-item-link href=https://blog.itning.top/post/>归档</a></li><li class=menu-item><a class=menu-item-link href=https://blog.itning.top/tags/>标签</a></li><li class=menu-item><a class=menu-item-link href=https://blog.itning.top/categories/>分类</a></li><li class=menu-item><a class=menu-item-link href=https://github.com/itning rel=noopener target=_blank>GitHub
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408 512.128C896 481.792 871.424 457.152 841.152 457.152z"/></svg></i></a></li></ul></nav></header><div id=mobile-panel><main id=main class="main bg-llight"><div class=content-wrapper><div id=content class="content container"><article class="post bg-white"><header class=post-header><h1 class=post-title>JVM系列2 Class文件格式</h1><div class=post-meta><time datetime=2020-04-10 class=post-time>2020年04月10日 11:02:39</time><div class=post-category><a href=https://blog.itning.top/categories/jvm/>jvm</a></div><span class=more-meta>约 540 字</span>
<span class=more-meta>预计阅读 3 分钟</span>
<span id=busuanzi_container_page_pv>| 阅读 <span id=busuanzi_value_page_pv></span></span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#一-概述>一、 概述</a></li><li><a href=#二class组成>二、Class组成</a><ul><li><a href=#21-相关概念>2.1 相关概念</a></li><li><a href=#22-classfile结构>2.2 ClassFile结构</a></li></ul></li><li><a href=#三classfile文件组成>三、ClassFile文件组成</a><ul><li><a href=#31-魔数>3.1 魔数</a></li><li><a href=#32-版本号>3.2 版本号</a></li><li><a href=#33-常量池>3.3 常量池</a></li><li><a href=#34-访问标识>3.4 访问标识</a></li><li><a href=#35-类父类索引>3.5 类/父类索引</a></li><li><a href=#36-接口索引>3.6 接口索引</a></li><li><a href=#37-字段表>3.7 字段表</a></li><li><a href=#38-方法表>3.8 方法表</a></li><li><a href=#39-属性表>3.9 属性表</a></li></ul></li></ul></nav></div></div><div class=post-content><blockquote><p>Java编译过程是将Java文件转换为Claaa文件，从而实现了跨平台的功能， 本文详细讲述Class文件结构。</p></blockquote><h2 id=一-概述>一、 概述</h2><p>计算机只能识别0和1，所以大家编写的程序都需要经过编译器，转换为由0和1组成的二进制本地机器码(Native Code)。随着虚拟机的不断发展，很多程序语言开始选择与操作系统和机器指令集无关的格式作为编译后的存储格式（Class文件），从而实现”Write Once, Run Anywhere”。 Java设计之初，考虑后期能让Java虚拟机运行其他语言，目前有越来越多的其他语言都可以直接需要在Java虚拟机，虚拟机只能识别Class文件，至于是由何种语言编译而来的，虚拟机并不关心，如下图：</p><p><img src=/images/20200410110400.png alt=Jvm_class_loading_1></p><p>可以看出不管是由Java语言，还是JRuby等其他语言，只能能生成.class字节码文件，就都可以运行在Java虚拟机上。故发布规范文档时，Java规范拆分为Java语言规范和Java虚拟机规范。</p><p>Java语法中定义各种变量、关键字、运算符的语义最终由多个字节码命令组合而成。因此字节码命令所能提供的语义描述能力必然要比Java语言本身更加强大。</p><h2 id=二class组成>二、Class组成</h2><p>Class文件是一组以8位字节为单位的二进制流，中间没有任何分隔符，非常紧凑。 当需要占用8位以上的数据时，会按照Big-endian顺序，高位在前，低位在后的方式来分割成多个8位字节来存储。</p><ul><li>任何一个Class文件都对应着唯一的类或接口的定义信息；</li><li>类或接口并不一定定义在文件里，也可以通过类加载器直接生成。</li></ul><p>Java虚拟机规范规定：Class文件格式采用伪结构来存储数据，伪结构中只有无符号数和表这两种数据类型。</p><ul><li>无符号数：是基本数据类型，以u1、u2、u4、u8分别代表1个字节、2个字节、4个字节、8个字节的无符号数。无符号数用于描述数字、索引引用、数量值、字符串值。</li><li>表：是由多个无符号数或者子表作为数据项构成的符合数据类型。用于描述有层次关系的复合结构的数据。整个Class其实就是一张表。</li></ul><h3 id=21-相关概念>2.1 相关概念</h3><p>下面介绍几个概述：</p><h4 id=全限定名>全限定名</h4><p>是指把类全名中的“.”号，用“/”号替换，并且在最后加入一个“；”分号后生成的名称。比如<code>java.lang.Object</code>对应的全限定名为<code>java/lang/Object;</code> 。</p><h4 id=简单名>简单名</h4><p>这个比较好理解，就是直接的方法名或者字段。比如<code>toString()</code>方法，不需要包名作为前缀了。</p><h4 id=字段描述符>字段描述符</h4><p>用于描述字段的数据类型。</p><p>规则如下：</p><table><thead><tr><th>基本类型字符</th><th>对应类型</th></tr></thead><tbody><tr><td>B</td><td>byte</td></tr><tr><td>C</td><td>char</td></tr><tr><td>D</td><td>double</td></tr><tr><td>F</td><td>float</td></tr><tr><td>I</td><td>int</td></tr><tr><td>S</td><td>short</td></tr><tr><td>J</td><td>long</td></tr><tr><td>Z</td><td>boolean</td></tr><tr><td>V</td><td>void</td></tr><tr><td>L+classname +;</td><td>对象类型</td></tr><tr><td>[</td><td>数组类型</td></tr></tbody></table><p>例如：</p><ul><li>基本类型：int ==> I</li><li>对象类型：String ==> Ljava/lang/String;</li><li>数组类型：long[] ==> [J</li></ul><h4 id=方法描述符>方法描述符</h4><p>用来描述方法的参数列表(数量、类型以及顺序)和返回值。</p><p>格式：(参数描述符列表)返回值描述符:
例如：<code>Object m(int i, double d, Thread t) {..}</code> ==> <code>IDLjava/lang/Thread;)Ljava/lang/Object;</code></p><h3 id=22-classfile结构>2.2 ClassFile结构</h3><p>一个Class类文件是由一个ClassFile结构组成：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-shell data-lang=shell>ClassFile <span class=o>{</span>
    u4             magic<span class=p>;</span>               //魔数，固定值0xCAFEBABE
    u2             minor_version<span class=p>;</span>       //次版本号
    u2             major_version<span class=p>;</span>       //主版本号
    u2             constant_pool_count<span class=p>;</span> //常量的个数
    cp_info        constant_pool<span class=o>[</span>constant_pool_count-1<span class=o>]</span><span class=p>;</span>  //具体的常量池内容
    u2             access_flags<span class=p>;</span>        //访问标识
    u2             this_class<span class=p>;</span>          //当前类索引
    u2             super_class<span class=p>;</span>         //父类索引
    u2             interfaces_count<span class=p>;</span>    //接口的个数
    u2             interfaces<span class=o>[</span>interfaces_count<span class=o>]</span><span class=p>;</span>          //具体的接口内容
    u2             fields_count<span class=p>;</span>        //字段的个数
    field_info     fields<span class=o>[</span>fields_count<span class=o>]</span><span class=p>;</span>                  //具体的字段内容
    u2             methods_count<span class=p>;</span>       //方法的个数
    method_info    methods<span class=o>[</span>methods_count<span class=o>]</span><span class=p>;</span>                //具体的方法内容
    u2             attributes_count<span class=p>;</span>    //属性的个数
    attribute_info attributes<span class=o>[</span>attributes_count<span class=o>]</span><span class=p>;</span>          //具体的属性内容
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>一个Class文件的大小：26 + cp_info[] + u2[] + field_info[] + method_info[] + attribute_info[]</p><p>接下来，将具体来介绍ClassFile文件的各个组成部分。</p><h2 id=三classfile文件组成>三、ClassFile文件组成</h2><h3 id=31-魔数>3.1 魔数</h3><p>每个Class文件头4个字节称为魔数(Magic Number),作用是用于确定这个Class文件是否能被虚拟机所接受，魔数固定值0xCAFEBABE。这是身份识别，比如jpeg等图片文件头也会有魔数。</p><h3 id=32-版本号>3.2 版本号</h3><p>紧跟魔数，也占用4个字节。从第5字节到第8字节存储的分别是 次版本号，主版本号。</p><h3 id=33-常量池>3.3 常量池</h3><p>常量池是Class文件空间最大的数据项之一，长度不固定。</p><p>a. 常量池长度 用u2类型代表常量池容量计数值，u2紧跟版本号。u2的大小等于常量池的常量个数+1。对于u2=0的特殊情况，代表没有使用常量池。</p><p>b. 常量池内容,格式如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-shell data-lang=shell>cp_info <span class=o>{</span>
    u1 tag<span class=p>;</span>
    u1 info<span class=o>[]</span><span class=p>;</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>包括两个类常量，字面量和符号引用：</p><ul><li>字面量：与Java语言层面的常量概念相近，包含文本字符串、声明为final的常量值等。</li><li>符号引用：编译语言层面的概念，包括以下3类：<ul><li>类和接口的全限定名</li><li>字段的名称和描述符</li><li>方法的名称和描述符</li></ul></li></ul><p>常量池中每一项常量都是一个表结构，每个表的开始第一位是u1类型的标志位tag, 代表当前这个常量的类型。在JDK 1.7.中共有14种不同的表结构的类型，如下：</p><p><img src=/images/20200410110900.png alt=constant_type></p><p>Class文件都是二进制格式，可通过<code>Jdk/bin/javap.exe</code>工具，分析Class文件字节码。关于javap用法，可通过<code>javap --help</code>来查看。</p><h3 id=34-访问标识>3.4 访问标识</h3><p>2个字节代表，标示用于识别一些类或者接口层次的访问信息.</p><table><thead><tr><th>标识名</th><th>标识值</th><th>解释</th></tr></thead><tbody><tr><td>ACC_PUBLIC</td><td>0x0001</td><td>声明为public;可以从包外部访问</td></tr><tr><td>ACC_FINAL</td><td>0x0010</td><td>被声明为final;不允许子类修改</td></tr><tr><td>ACC_SUPER</td><td>0x0020</td><td>当被invokespecial指令调用时，将特殊对待父类的方法</td></tr><tr><td>ACC_INTERFACE</td><td>0x0200</td><td>接口标识符</td></tr><tr><td>ACC_ABSTRACT</td><td>0x0400</td><td>声明为abstract;不能被实例化</td></tr><tr><td>ACC_SYNTHETIC</td><td>0x1000</td><td>声明为synthetic;不存在于源代码，由编译器生成</td></tr><tr><td>ACC_ANNOTATION</td><td>0x2000</td><td>声明为注释类型</td></tr><tr><td>ACC_ENUM</td><td>0x4000</td><td>声明为枚举类型</td></tr></tbody></table><h3 id=35-类父类索引>3.5 类/父类索引</h3><p>当前类索引和父类索引占用大小都为u2类型，由于一个类智能继承一个父类，故父类索引只有一个。除了java.lang.Object对象的父类索引为0，其他所有类都有父类。</p><h3 id=36-接口索引>3.6 接口索引</h3><p>一个类可以实现多个接口，故利用interfaces_count来记录该类所实现的接口个数，interfaces[interfaces_count]来记录所有实现的接口内容。</p><h3 id=37-字段表>3.7 字段表</h3><p>字段表用于描述类或接口中声明的变量，格式如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-shell data-lang=shell>field_info <span class=o>{</span>
    u2             access_flags<span class=p>;</span> //访问标识
    u2             name_index<span class=p>;</span>  //名称索引
    u2             descriptor_index<span class=p>;</span> //描述符索引
    u2             attributes_count<span class=p>;</span> //属性个数
    attribute_info attributes<span class=o>[</span>attributes_count<span class=o>]</span><span class=p>;</span>  //属性表的具体内容
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>字段访问标识如下：(表中加粗项是字段独有的)</p><table><thead><tr><th>标识名</th><th>标识值</th><th>解释</th></tr></thead><tbody><tr><td>ACC_PUBLIC</td><td>0x0001</td><td>声明为 public; 可以从包外部访问</td></tr><tr><td>ACC_PRIVATE</td><td>0x0002</td><td>声明为 private; 只有定义的类可以访问</td></tr><tr><td>ACC_PROTECTED</td><td>0x0004</td><td>声明为 protected;只有子类和相同package的类可访问</td></tr><tr><td>ACC_STATIC</td><td>0x0008</td><td>声明为 static；属于类变量</td></tr><tr><td>ACC_FINAL</td><td>0x0010</td><td>声明为 final; 对象构造后无法直接修改值</td></tr><tr><td><strong>ACC_VOLATILE</strong></td><td>0x0040</td><td>声明为 volatile; 不会被缓存,直接刷新到主屏幕</td></tr><tr><td><strong>ACC_TRANSIENT</strong></td><td>0x0080</td><td>声明为 transient; 不能被序列化</td></tr><tr><td>ACC_SYNTHETIC</td><td>0x1000</td><td>声明为 synthetic; 不存在于源代码，由编译器生成</td></tr><tr><td>ACC_ENUM</td><td>0x4000</td><td>声明为enum</td></tr></tbody></table><p>Java语法中，接口中的字段默认包含ACC_PUBLIC, ACC_STATIC, ACC_FINAL标识。ACC_FINAL，ACC_VOLATILE不能同时选择等规则。</p><p>紧跟其后的name_index和descriptor_index是对常量池的引用，分别代表着字段的简单名和方法的描述符。</p><h3 id=38-方法表>3.8 方法表</h3><p>方法表用于描述类或接口中声明的方法，格式如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-shell data-lang=shell>method_info <span class=o>{</span>
    u2             access_flags<span class=p>;</span> //访问标识
    u2             name_index<span class=p>;</span>  //名称索引
    u2             descriptor_index<span class=p>;</span>  //描述符索引
    u2             attributes_count<span class=p>;</span>  //属性个数
    attribute_info attributes<span class=o>[</span>attributes_count<span class=o>]</span><span class=p>;</span> //属性表的具体内容
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>方法访问标识如下：(表中加粗项是方法独有的)</p><table><thead><tr><th>标识名</th><th>标识值</th><th>解释</th></tr></thead><tbody><tr><td>ACC_PUBLIC</td><td>0x0001</td><td>声明为 public; 可以从包外部访问</td></tr><tr><td>ACC_PRIVATE</td><td>0x0002</td><td>声明为 private; 只有定义的类可以访问</td></tr><tr><td>ACC_PROTECTED</td><td>0x0004</td><td>声明为 protected;只有子类和相同package的类可访问</td></tr><tr><td>ACC_STATIC</td><td>0x0008</td><td>声明为 static；属于类变量</td></tr><tr><td>ACC_FINAL</td><td>0x0010</td><td>声明为 final; 不能被覆写</td></tr><tr><td><strong>ACC_SYNCHRONIZED</strong></td><td>0x0020</td><td>声明为 synchronized; 同步锁包裹</td></tr><tr><td>ACC_BRIDGE</td><td>0x0040</td><td>桥接方法, 由编译器生成</td></tr><tr><td><strong>ACC_VARARGS</strong></td><td>0x0080</td><td>声明为 接收不定长参数</td></tr><tr><td><strong>ACC_NATIVE</strong></td><td>0x0100</td><td>声明为 native; 由非Java语言来实现</td></tr><tr><td><strong>ACC_ABSTRACT</strong></td><td>0x0400</td><td>声明为 abstract; 没有提供实现</td></tr><tr><td><strong>ACC_STRICT</strong></td><td>0x0800</td><td>声明为 strictfp; 浮点模式是FP-strict</td></tr><tr><td>ACC_SYNTHETIC</td><td>0x1000</td><td>声明为 synthetic; 不存在于源代码，由编译器生成</td></tr></tbody></table><ul><li>对于方法里的Java代码，进过编译器编译成字节码指令后，存放在方法属性表集合中“code”的属性内。</li><li>当子类没有覆写父类方法，则方法集合中不会出现父类的方法信息。</li><li>Java语言中重载方法，必须与原方法同名，且特征签名不同。特征签名是指方法中各个参数在常量池的字段符号引用的集合，不包括返回值。当时Class文件格式中，特征签名范围更广，允许方法名和特征签名都相同，但返回值不同的方法，合法地共存子啊同一个Class文件中</li></ul><h3 id=39-属性表>3.9 属性表</h3><p>属性表格式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-shell data-lang=shell>attribute_info <span class=o>{</span>
    u2 attribute_name_index<span class=p>;</span>   //属性名索引
    u4 attribute_length<span class=p>;</span>       //属性长度
    u1 info<span class=o>[</span>attribute_length<span class=o>]</span><span class=p>;</span> //属性的具体内容
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>属性表的限制相对宽松，不需要各个属性表有严格的顺序，只有不与已有的属性名重复，任何自定义的编译器都可以向属性表中写入自定义的属性信息，Java虚拟机运行时会忽略掉无法识别的属性。 关于虚拟机规范中预定义的属性，这里不展开讲了，列举几个常用的。</p><table><thead><tr><th>属性名</th><th>使用位置</th><th>解释</th></tr></thead><tbody><tr><td>Code</td><td>方法表</td><td>方法体的内容</td></tr><tr><td>ConstantValue</td><td>字段表</td><td>final关键字定义的常量值</td></tr><tr><td>Deprecated</td><td>类、方法表、字段表</td><td>声明为deprecated</td></tr><tr><td>InnerClasses</td><td>类文件</td><td>内部类的列表</td></tr><tr><td>LineNumberTable</td><td>Code属性</td><td>Java源码的行号与字节码指令的对应关系</td></tr><tr><td>LocalVariableTable</td><td>Code属性</td><td>方法的局部变量描述</td></tr><tr><td>Signature</td><td>类、方法表、字段表</td><td>用于支持泛型的方法签名，由于Java的泛型采用擦除法，避免类型信息被擦除后导致签名混乱，Signature记录相关信息</td></tr></tbody></table><p><strong>Code属性</strong> java程序方法体中的代码，经编译后得到的字节码指令存储在Code属性内，Code属性位于方法表的属性集合中。但与native或者abstract的方法则不会存在Code属性中。</p><p>Code属性的格式如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-shell data-lang=shell>Code_attribute <span class=o>{</span>
    u2 attribute_name_index<span class=p>;</span> //常量池中的uft8类型的索引，值固定为”Code“
    u4 attribute_length<span class=p>;</span> //属性值长度，为整个属性表长度-6
    u2 max_stack<span class=p>;</span>   //操作数栈的最大深度值，jvm运行时根据该值佩服栈帧
    u2 max_locals<span class=p>;</span>  //局部变量表最大存储空间，单位是slot
    u4 code_length<span class=p>;</span> // 字节码指令的个数
    u1 code<span class=o>[</span>code_length<span class=o>]</span><span class=p>;</span> // 具体的字节码指令
    u2 exception_table_length<span class=p>;</span> //异常的个数
    <span class=o>{</span>   u2 start_pc<span class=p>;</span>
        u2 end_pc<span class=p>;</span>
        u2 handler_pc<span class=p>;</span> //当字节码在<span class=o>[</span>start_pc, end_pc<span class=o>)</span>区间出现catch_type或子类，则转到handler_pc行继续处理。
        u2 catch_type<span class=p>;</span> //当catch_type<span class=o>=</span>0，则任意异常都需转到handler_pc处理
    <span class=o>}</span> exception_table<span class=o>[</span>exception_table_length<span class=o>]</span><span class=p>;</span> //具体的异常内容
    u2 attributes_count<span class=p>;</span>     //属性的个数
    attribute_info attributes<span class=o>[</span>attributes_count<span class=o>]</span><span class=p>;</span> //具体的属性内容
<span class=o>}</span>
</code></pre></td></tr></table></div></div><ul><li>slot是虚拟机未局部变量分配内存使用的最小单位。对于byte/char/float/int/short/boolean/returnAddress等长度不超过32位的局部变量，每个占用1个Slot；对于long和double这两种64位的数据类型则需要2个Slot来存放。</li><li>实例方法中有隐藏参数this, 显式异常处理器的参数，方法体定义的局部变量都使用局部变量表来存放。</li><li>max_locals，不是所有局部变量所占Slot之和，因为Slot可以重用，javac编译器会根据变量的作用域来分配Slot给各个变量使用，从而计算出max_locals大小。</li><li>虚拟机规范限制严格方法不允许超过65535个字节码，否则拒绝编译。</li></ul><p>Code属性是Class文件中最重要的属性，Java程序的幸福课分为代码(方法体中的Java代码)和元数据(包含类、接口、字段、方法定义以及其他信息)两部分。</p><p><strong>ConstantValue属性</strong> ConstantValue属性是指被static关键字修饰的变量（也称为类变量）。</p><ul><li>类变量: 在类构造器方法或者使用ConstantValue属性来赋值</li><li>实例变量：在实例构造器方法进行赋值</li></ul><blockquote><p>参考资料</p><ol><li><a href=https://docs.oracle.com/javase/specs/jvms/se7/html/>https://docs.oracle.com/javase/specs/jvms/se7/html/</a></li><li>Java语言规范《The Java Language Specification》</li><li>Java虚拟机规范《The Java Virtual Machine Specification》</li></ol></blockquote></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>Gityuan</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2020年04月10日 11:02:39</span></p><p class=copyright-item><span class=item-title>许可协议</span>
<span class=item-content><a href=http://gityuan.com/2015/10/18/jvm-class-instruction/ target=_blank>Posted by Gityuan on October 18, 2015</a></span></p></div><footer class=post-footer><div class=post-tags><a href=https://blog.itning.top/tags/jvm/>JVM</a></div><nav class=post-nav><a class=prev href=/post/2020/04/10/jvm%E7%B3%BB%E5%88%973-%E5%AD%97%E8%8A%82%E7%A0%81%E6%8C%87%E4%BB%A4/><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417l277.93508-310.326815c11.338233-12.190647 11.035334-32.285311-.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"/></svg></i><span class="prev-text nav-default">JVM系列3 字节码指令</span>
<span class="prev-text nav-mobile">上一篇</span></a>
<a class=next href=/post/2020/04/10/jvm%E7%B3%BB%E5%88%971-%E8%BF%90%E8%A1%8C%E6%97%B6%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84/><span class="next-text nav-default">JVM系列1 运行时内存结构</span>
<span class="prev-text nav-mobile">下一篇</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"/></svg></i></a></nav></footer></article><div class="post bg-white"><script src=https://utteranc.es/client.js repo=itning/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div></div></main><footer id=footer class=footer><div class=icon-links><a href=mailto:itning@itning.top rel="me noopener" class=iconfont title=email><svg class="icon" viewBox="0 0 1451 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408 1361.641813S1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523L83.726336 1024H682.532949 753.579947 1348.948139L1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955C777.248 802.205449 742.347691 811.03081 718.063616 811.603883z"/></svg></a><a href=http://github.com/itning rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg></a><a href=https://blog.itning.top/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg></a></div><div class=copyright><span class=copyright-year>&copy;
2016 -
2020
<span class=heart><i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg></i></span><span class=author>itning
</span><script type=text/javascript>document.write(unescape("%3Cspan id='cnzz_stat_icon_1278714977'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1278714977%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script></span><span id=busuanzi_container>访客数/访问量：<span id=busuanzi_value_site_uv></span>/<span id=busuanzi_value_site_pv></span></span>
<span>黑ICP备17003448号</span></div></footer><div class=back-to-top id=back-to-top><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg></i></div></div><script src=https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js></script><script src=https://cdn.bootcss.com/slideout/1.0.1/slideout.min.js></script><script type=text/javascript src=/js/main.dee43230127a73d039a734510fa896c89c3c7ce0cf0be0c7a7433f8fd69b76dc.js crossorigin=anonymous></script><script type=text/javascript src=/js/load-photoswipe.js></script><script src=https://cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.js></script><script src=https://cdn.bootcss.com/photoswipe/4.1.3/photoswipe-ui-default.min.js></script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>